"use strict";function initShowEmailModals(){$("a.showEmailModal").click(function(e){e.preventDefault(),$.ajax({url:$(this).data("url"),type:"POST",dataType:"html"}).done(function(e){$(e).modal("show"),initSendEmailForm(),$(".ui.modal").modal("refresh")})})}function initSendEmailForm(){$(".emailmessageredactor").redactor({buttons:["bold","italic","link"]}),$(".sendemailform").submit(function(e){e.preventDefault(),$(this).find("button.pink").addClass("loading");var t=$(this).serialize();$form=$(this),$.post("/",t,function(e){console.log(e),"success"==e?($form.find("div.field, div.actions").slideUp(),$form.addClass("success"),updateWaitingListTable()):$form.addClass("error")})})}function initAttendenceForm(){$(".attendenceform").submit(function(e){e.preventDefault(),$form=$(this),$form.find(".updateregisterbutton").addClass("loading");var t=$form.serialize();$.post("/",t,function(e){"success"==e&&($form.find(".updateregisterbutton").removeClass("pink loading").addClass("disabled"),$("body form .updateregisterbutton.pink").length||exitMessage("unbind"))})})}function initUpdateOrderForm(){$(".updateorderform").submit(function(e){e.preventDefault(),$form=$(this),$names=[],$lineId=$form.data("lineid"),$notes=$(this).find("input.notes-"+$lineId).val(),$(this).find("input.names-"+$lineId).each(function(){$names.push($(this).val())}),console.log($names);var t=$(this).serialize();$.post("/",t,function(e){"success"==e?($form.addClass("success"),setTimeout(function(){$(".ui.modal").modal("hide"),console.log($form.data("lineid")),$i=0,console.log("i: "+$i),$("#"+$form.data("lineid")+" td.names").find("label").each(function(){$(this).text($names[$i]),console.log("i: "+$i),$i++}),$("#"+$form.data("lineid")+" td.notes").text($notes)},750)):$form.addClass("error")})})}function initUpdateTransactionForm(){$(".transactionupdateform").submit(function(e){e.preventDefault(),$(this).find("button").addClass("loading");var t=$(this).serialize();$form=$(this),$.post("/",t,function(e){console.log("data sent"),console.log(e),"success"==e?($form.find("button").removeClass("loading").addClass("active").text("PAID"),$("td#"+$form.data("shortnumber")+" span.red").addClass("green").removeClass("red").text("PAID")):$form.addClass("error")})})}function initOrderCancellationForm(){$(".ordercancellationform").submit(function(e){e.preventDefault();var t=$(this).serialize();$form=$(this),$dialog=confirm("Are you sure you want to cancel this order?"),1==$dialog&&($form.find("button").addClass("loading"),$.post("/",t,function(e){console.log("data sent"),console.log(e.success),!0===e.success?(console.log("CANCELLED"),$form.find("button").removeClass("loading"),$form.slideUp(),$form.addClass("success"),setTimeout(function(){$(".ordercancellationmessage").removeClass("hidden"),$("tr#"+$form.data("shortnumber")).addClass("cancelled"),$(".ui.modal").modal("hide")},750)):$form.addClass("error")}))})}function initLineItemQuantityForm(){$(".lineitemquantityform").submit(function(e){e.preventDefault();var t=$(this).serialize();$form=$(this),$form.find("button").addClass("loading"),$.post("/",t,function(e){"success"==e?($form.find("button").removeClass("loading"),$form.find(".success").removeClass("hidden"),setTimeout(function(){location.reload()},750)):($form.find("button").removeClass("loading"),$form.find(".error").removeClass("hidden"))})})}function initShowOrderModals(){$("a.showOrderModal").click(function(e){e.preventDefault(),$.ajax({url:$(this).data("url"),type:"POST",dataType:"html"}).done(function(e){$(e).modal("show"),initUpdateOrderForm(),initUpdateTransactionForm(),initOrderCancellationForm(),initLineItemQuantityForm()})})}function initShowClassModals(){$("a.showClassModal").click(function(e){e.preventDefault(),$.ajax({url:$(this).data("url"),type:"POST",dataType:"html"}).done(function(e){$(e).modal("show"),initShowOrderModals(),initShowEmailModals()})})}function initModals(){$("a.modal-trigger, button.modal-trigger").click(function(e){e.preventDefault(),$.ajax({url:$(this).data("url"),type:"POST",dataType:"html"}).done(function(e){$(e).modal("show"),initCheckboxes(),$("textarea").redactor({buttons:["bold","italic","link"]})})})}function convertToParsableDateString(e){var t=e.split("/");return new Date(t[2],t[1]-1,t[0])}function initClassesReportForm(){var e=["January","February","March","April","May","June","July","August","September","October","November","December"];$("#startdate").val()?($existingDate=convertToParsableDateString($("#startdate").val()),$friendlyDate=$existingDate.getDate()+" "+e[$existingDate.getMonth()]+" "+$existingDate.getFullYear()):$friendlyDate="",$("#enddate").val()?($existingDate=convertToParsableDateString($("#enddate").val()),$friendlyDate=$existingDate.getDate()+" "+e[$existingDate.getMonth()]+" "+$existingDate.getFullYear()):$friendlyDate="",$(".datefield").calendar({type:"date",onChange:function(e,t){$formattedDate=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),$(this).next("input[type=hidden]").val($formattedDate)}})}function initAddProductForm(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";""==e?e="[No class selected] ":e+=" on ",""==t&&(t="[No date selected]"),$("#producttitle").val(e+t)}$class=$("#classselect").children(":selected").text();var a=["January","February","March","April","May","June","July","August","September","October","November","December"];$("#dateinput").val()?($existingDate=convertToParsableDateString($("#dateinput").val()),$friendlyDate=$existingDate.getDate()+" "+a[$existingDate.getMonth()]+" "+$existingDate.getFullYear()):$friendlyDate="",$("#room, #startTime, #finishTime, #teacher").dropdown({fullTextSearch:!0}),$("#classselect").dropdown({fullTextSearch:!0,onChange:function(){$class=$(this).children(":selected").text(),i($class,$friendlyDate)}}),$("#date").calendar({type:"date",onChange:function(e,t){$formattedDate=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear(),$("#dateinput").val($formattedDate),$friendlyDate=e.getDate()+" "+a[e.getMonth()]+" "+e.getFullYear(),i($class,$friendlyDate)}}),$("#teacherselect").dropdown({onChange:function(){"nA"==$(this).val()?$(this).attr("name","fields[teacher]"):$(this).attr("name","fields[teacher][]")}}),$("#locationselect").dropdown({onChange:function(){"nA"==$(this).val()?$(this).attr("name","fields[location]"):$(this).attr("name","fields[location][]")}}),$("#addproductform").form({fields:{title:{identifier:"producttitle",rules:[{type:"empty"}]},class:{identifier:"classselect",rules:[{type:"empty"}]},date:{identifier:"dateinput-text",rules:[{type:"empty"}]},starttime:{identifier:"starttime",rules:[{type:"empty"}]},finishtime:{identifier:"finishtime",rules:[{type:"empty"}]},price:{identifier:"priceinput",rules:[{type:"empty"}]},places:{identifier:"placesinput",rules:[{type:"empty"}]}}}),$("#addproductbutton-another").click(function(e){e.preventDefault(),$("#redirectinput").val("products/add/{id}"),console.log($("#redirectinput").val()),$("#addproductform").submit()})}function initLoginForm(){$("#loginform").form({fields:{username:{identifier:"username",rules:[{type:"empty"}]},password:{identifier:"password",rules:[{type:"empty"}]}}})}function initAddEntryForm(){var i=["January","February","March","April","May","June","July","August","September","October","November","December"];$("#dateinput").val()?($existingDate=convertToParsableDateString($("#dateinput").val()),$friendlyDate=$existingDate.getDate()+" "+i[$existingDate.getMonth()]+" "+$existingDate.getFullYear()):$friendlyDate="",$("#date").calendar({type:"date",onChange:function(e,t){$formattedDate=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear(),$("#dateinput").val($formattedDate),$friendlyDate=e.getDate()+" "+i[e.getMonth()]+" "+e.getFullYear()}}),$("#addentryform").form({fields:{title:{identifier:"producttitle",rules:[{type:"empty"}]},date:{identifier:"dateinput-text",rules:[{type:"empty"}]}}})}function exitMessage(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"bind";window.onbeforeunload="bind"==e?function(){return"You have unsaved changes. Are you sure you want to leave this page?"}:null}function saveMessage(e){}$(document).ready(function(){$("#full-courses-toggle").click(function(e){$("a.full").toggle(),$(this).text(function(e,t){return"Hide full courses"===t?"Show all courses":"Hide full courses"}),$(this).hasClass("pink")?$(this).removeClass("pink"):$(this).addClass("pink")}),$(".ui.accordion").accordion(),$(".menu .item").tab(),$("#additionaldescription").redactor({buttons:["bold","italic"]}),$(".message .close").on("click",function(){$(this).closest(".message").transition("fade")}),initShowEmailModals(),initShowClassModals(),initClassesReportForm(),initAddProductForm(),initAttendenceForm(),initLoginForm(),initCheckboxes(),initModals(),initShowOrderModals(),initWaitingListEmailButton(),loadSalesReportsFromTable(),loadSalesReportsFromForm()});